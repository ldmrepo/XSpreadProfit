# **거래소 데이터 수집 및 저장 설계 문서**

---

## **1. 개요**

본 문서는 업비트, 빗썸, 코인원 등 국내 거래소와 바이낸스, 바이빗 등 해외 거래소에서 거래 데이터를 수집, 표준화, 저장, 분석하는 프로세스를 정의합니다.  
데이터는 거래소별로 수집 및 정규화 과정을 거치며, Redis에 체계적으로 저장되어 이후 데이터 분석 및 구독 프로세스에 활용됩니다.

---

## **2. 데이터 종류**

거래소 데이터는 다음과 같은 종류로 구분됩니다:

1. **거래소 원본 데이터**

    - 각 거래소의 API에서 수집한 원본 데이터.
    - 거래소마다 고유 형식을 가지며, 정규화되지 않은 상태로 저장됩니다.

2. **표준화된 거래소 데이터**

    - 거래소 원본 데이터를 표준 데이터 구조로 변환한 데이터.
    - 모든 거래소 데이터를 통일된 형식으로 변환하여 처리와 분석에 활용됩니다.

3. **전체 마스터 데이터**

    - 국내 거래소(업비트, 빗썸, 코인원)의 데이터를 합집합하여 생성된 데이터.
    - 전체 시장에서 거래 가능한 자산과 거래소를 나타냅니다.

4. **거래소별 마스터 데이터**
    - 전체 마스터 데이터와 특정 거래소 데이터를 교집합하여 생성된 데이터.
    - 각 거래소에서 거래 가능한 마켓 정보를 포함합니다.

---

## **3. 데이터 구조**

### **1) 거래소 원본 데이터**

-   **설명**: 각 거래소의 API에서 수집한 데이터를 정규화하기 전에 저장하는 데이터.
-   **구조**: 거래소마다 고유 필드 및 포맷을 가짐.

| 필드명           | 설명                                | 예시                    |
| ---------------- | ----------------------------------- | ----------------------- |
| 거래소 고유 심볼 | 거래소에서 정의한 고유 마켓 심볼    | `KRW-BTC`               |
| 자산 심볼        | 거래의 기본 자산 (Base Asset) 심볼  | `BTC`                   |
| 거래 대상 심볼   | 거래의 대상 자산 (Quote Asset) 심볼 | `KRW`                   |
| 상태             | 거래소가 정의한 활성화 상태         | `ACTIVE`                |
| 기타             | 거래소별로 제공하는 추가적인 데이터 | `{ "leverage": "10x" }` |

---

### **2) 표준화된 거래소 데이터**

-   **설명**: 모든 거래소 데이터를 동일한 데이터 구조로 정규화.
-   **구조**:

| 필드명         | 설명                                      | 예시                    |
| -------------- | ----------------------------------------- | ----------------------- |
| marketSymbol   | 거래소에서 정의한 고유 마켓 심볼          | `KRW-BTC`               |
| baseSymbol     | 거래의 기본 자산 (Base Asset) 심볼        | `BTC`                   |
| quoteSymbol    | 거래의 대상 자산 (Quote Asset) 심볼       | `KRW`                   |
| type           | 시장 종류 (`spot` 또는 `futures`)         | `spot`                  |
| exchange       | 데이터를 제공하는 거래소 이름             | `upbit`                 |
| status         | 시장의 활성화 상태 (`active`, `inactive`) | `active`                |
| additionalInfo | 거래소별 추가 정보 (옵션)                 | `{ "leverage": "10x" }` |

---

### **3) 전체 마스터 데이터**

-   **설명**: 국내 거래소 데이터를 합집합하여 생성된 데이터.
-   **구조**:

| 필드명          | 설명                                      | 예시                   |
| --------------- | ----------------------------------------- | ---------------------- |
| marketSymbol    | 거래소에서 정의한 고유 마켓 심볼          | `KRW-BTC`              |
| baseSymbol      | 거래의 기본 자산 (Base Asset) 심볼        | `BTC`                  |
| quoteSymbol     | 거래의 대상 자산 (Quote Asset) 심볼       | `KRW`                  |
| type            | 시장 종류 (`spot` 또는 `futures`)         | `spot`                 |
| sourceExchanges | 해당 마켓을 제공하는 국내 거래소 목록     | `["upbit", "bithumb"]` |
| status          | 시장의 활성화 상태 (`active`, `inactive`) | `active`               |

---

### **4) 거래소별 마스터 데이터**

-   **설명**: 전체 마스터 데이터와 특정 거래소 데이터를 교집합하여 생성된 데이터.
-   **구조**:

| 필드명       | 설명                                      | 예시      |
| ------------ | ----------------------------------------- | --------- |
| marketSymbol | 거래소에서 정의한 고유 마켓 심볼          | `KRW-BTC` |
| baseSymbol   | 거래의 기본 자산 (Base Asset) 심볼        | `BTC`     |
| quoteSymbol  | 거래의 대상 자산 (Quote Asset) 심볼       | `KRW`     |
| type         | 시장 종류 (`spot` 또는 `futures`)         | `spot`    |
| exchange     | 데이터를 제공하는 거래소 이름             | `upbit`   |
| status       | 시장의 활성화 상태 (`active`, `inactive`) | `active`  |

---

## **4. Redis 저장 구조**

### **1) 거래소 원본 데이터**

-   **키 구조**: `original:<exchange>:<marketSymbol>`
-   **값 구조**: 원본 데이터를 JSON 문자열 형태로 저장.
-   **예시**:
    ```
    Key: original:upbit:KRW-BTC
    Value: {"market":"KRW-BTC","baseAsset":"BTC","quoteAsset":"KRW","status":"ACTIVE"}
    ```

---

### **2) 표준화된 거래소 데이터**

-   **키 구조**: `standardized:<exchange>:<marketSymbol>`
-   **값 구조**: 표준화된 데이터를 JSON 문자열 형태로 저장.
-   **예시**:
    ```
    Key: standardized:binance:BTCUSDT
    Value: {"marketSymbol":"BTCUSDT","baseSymbol":"BTC","quoteSymbol":"USDT","type":"spot","exchange":"binance","status":"active"}
    ```

---

### **3) 전체 마스터 데이터**

-   **키 구조**: `master:<marketSymbol>`
-   **값 구조**: 국내 거래소에서 생성된 합집합 데이터를 저장.
-   **예시**:
    ```
    Key: master:BTCUSDT
    Value: {"marketSymbol":"BTCUSDT","baseSymbol":"BTC","quoteSymbol":"USDT","type":"spot","sourceExchanges":["binance","bybit"],"status":"active"}
    ```

---

### **4) 거래소별 마스터 데이터**

-   **키 구조**: `master:<exchange>:<marketSymbol>`
-   **값 구조**: 거래소별 교집합 데이터를 저장.
-   **예시**:
    ```
    Key: master:upbit:KRW-BTC
    Value: {"marketSymbol":"KRW-BTC","baseSymbol":"BTC","quoteSymbol":"KRW","type":"spot","exchange":"upbit","status":"active"}
    ```

---

## **5. 데이터 활용 시나리오**

1. **거래소별 데이터 조회**:

    - 특정 거래소의 데이터를 조회하여 현재 활성화된 시장 확인.

2. **전체 시장 분석**:

    - 전체 마스터 데이터를 기반으로 시장의 활성화 상태와 제공하는 거래소 목록 분석.

3. **데이터 구독 및 처리**:

    - 거래소별 마스터 데이터를 기반으로 거래 데이터를 구독 및 실시간 처리.

4. **데이터 동기화 및 교집합 처리**:
    - Redis에 저장된 데이터를 활용해 각 거래소의 교집합 또는 차집합 연산 수행.

---

## **6. 결론**

-   본 설계는 여러 거래소 데이터를 체계적으로 수집, 정규화, 저장, 분석할 수 있도록 설계되었습니다.
-   Redis 저장 구조는 빠른 조회와 확장성을 고려하여 설계되었으며, 데이터 분석 및 구독 처리에 적합합니다.
