# **거래소 실시간 데이터 공통 구조 설계 문서**

---

**버전:** 1.1  
**최종 수정일:** 2024년 12월 9일

---

## **목차**

1. [개요](#1-개요)
2. [데이터 종류](#2-데이터-종류)
    - [거래소 데이터](#21-거래소-데이터)
    - [실시간 데이터](#22-실시간-데이터)
3. [데이터 구조](#3-데이터-구조)
    - [거래소 데이터 구조](#31-거래소-데이터-구조)
    - [전체 마스터 데이터 구조](#32-전체-마스터-데이터-구조)
    - [거래소별 마스터 데이터 구조](#33-거래소별-마스터-데이터-구조)
    - [실시간 데이터 구조](#34-실시간-데이터-구조)
4. [Redis 저장 구조](#4-redis-저장-구조)
5. [데이터 설계 규칙](#5-데이터-설계-규칙)
6. [활용 방안](#6-활용-방안)
7. [결론](#7-결론)

---

## **1. 개요**

본 문서는 업비트, 빗썸, 코인원 등 국내 거래소와 바이낸스, 바이빗 등 해외 거래소에서 거래 데이터를 수집, 정규화, 저장, 분석하는 프로세스를 정의합니다.  
데이터는 다음과 같은 단계로 처리됩니다:

1. **거래소 원본 데이터 수집**: 거래소별 고유 형식의 데이터를 API를 통해 수집.
2. **표준화된 거래소 데이터 생성**: 수집된 데이터를 통합된 형식으로 변환.
3. **전체 및 거래소별 마스터 데이터 생성**: 데이터 분석과 구독에 최적화된 구조로 저장.
4. **실시간 데이터 처리**: 주문서 상태와 최우선 호가 정보를 실시간으로 수집 및 저장.

Redis를 활용하여 데이터를 저장하고, 이를 통해 빠르고 효율적인 데이터 조회와 실시간 분석이 가능하도록 설계되었습니다.

---

## **2. 데이터 종류**

### **2.1 거래소 데이터**

거래소 데이터는 다음과 같은 종류로 구분됩니다:

1. **거래소 원본 데이터**

    - 거래소 API에서 수집된 정규화되지 않은 원본 데이터.

2. **표준화된 거래소 데이터**

    - 거래소별 데이터를 공통된 데이터 구조로 변환한 데이터.

3. **전체 마스터 데이터**

    - 모든 거래소 데이터를 통합한 데이터.

4. **거래소별 마스터 데이터**
    - 전체 마스터 데이터에서 특정 거래소와 교집합하여 생성된 데이터.

---

### **2.2 실시간 데이터**

실시간 데이터는 다음 두 가지 유형으로 구분됩니다:

1. **호가 업데이트 스트림 (Order Book Ticker Streams)**

    - 최우선 매수/매도 가격과 수량을 실시간으로 제공.

2. **주문서 깊이 업데이트 스트림 (Order Book Depth Streams)**
    - 특정 가격 수준의 매수/매도 주문 상태를 실시간으로 제공.

---

## **3. 데이터 구조**

### **3.1 거래소 데이터 구조**

#### **1) 거래소 원본 데이터**

| 필드명           | 설명                                | 예시                    |
| ---------------- | ----------------------------------- | ----------------------- |
| 거래소 고유 심볼 | 거래소에서 정의한 고유 마켓 심볼    | `KRW-BTC`               |
| 자산 심볼        | 거래의 기본 자산 (Base Asset) 심볼  | `BTC`                   |
| 거래 대상 심볼   | 거래의 대상 자산 (Quote Asset) 심볼 | `KRW`                   |
| 상태             | 거래소가 정의한 활성화 상태         | `ACTIVE`                |
| 기타             | 거래소별로 제공하는 추가적인 데이터 | `{ "leverage": "10x" }` |

---

#### **2) 표준화된 거래소 데이터**

| 필드명         | 설명                                      | 예시                    |
| -------------- | ----------------------------------------- | ----------------------- |
| marketSymbol   | 거래소에서 정의한 고유 마켓 심볼          | `KRW-BTC`               |
| baseSymbol     | 거래의 기본 자산 (Base Asset) 심볼        | `BTC`                   |
| quoteSymbol    | 거래의 대상 자산 (Quote Asset) 심볼       | `KRW`                   |
| type           | 시장 종류 (`spot` 또는 `futures`)         | `spot`                  |
| exchange       | 데이터를 제공하는 거래소 이름             | `upbit`                 |
| status         | 시장의 활성화 상태 (`active`, `inactive`) | `active`                |
| additionalInfo | 거래소별 추가 정보 (옵션)                 | `{ "leverage": "10x" }` |

---

### **3.2 전체 마스터 데이터 구조**

| 필드명          | 설명                                      | 예시                   |
| --------------- | ----------------------------------------- | ---------------------- |
| marketSymbol    | 거래소에서 정의한 고유 마켓 심볼          | `KRW-BTC`              |
| baseSymbol      | 거래의 기본 자산 (Base Asset) 심볼        | `BTC`                  |
| quoteSymbol     | 거래의 대상 자산 (Quote Asset) 심볼       | `KRW`                  |
| type            | 시장 종류 (`spot` 또는 `futures`)         | `spot`                 |
| sourceExchanges | 해당 마켓을 제공하는 국내 거래소 목록     | `["upbit", "bithumb"]` |
| status          | 시장의 활성화 상태 (`active`, `inactive`) | `active`               |

---

### **3.3 거래소별 마스터 데이터 구조**

| 필드명       | 설명                                      | 예시      |
| ------------ | ----------------------------------------- | --------- |
| marketSymbol | 거래소에서 정의한 고유 마켓 심볼          | `KRW-BTC` |
| baseSymbol   | 거래의 기본 자산 (Base Asset) 심볼        | `BTC`     |
| quoteSymbol  | 거래의 대상 자산 (Quote Asset) 심볼       | `KRW`     |
| type         | 시장 종류 (`spot` 또는 `futures`)         | `spot`    |
| exchange     | 데이터를 제공하는 거래소 이름             | `upbit`   |
| status       | 시장의 활성화 상태 (`active`, `inactive`) | `active`  |

---

### **3.4 실시간 데이터 구조**

#### **1) 호가 업데이트 스트림 (Order Book Ticker Streams)**

| 필드명 | 전체 이름 (영문) | 데이터 유형    | 설명               | 예시            |
| ------ | ---------------- | -------------- | ------------------ | --------------- |
| `u`    | `updateId`       | 정수           | 주문서 업데이트 ID | `400900217`     |
| `s`    | `symbol`         | 문자열         | 거래 심볼          | `"BNBUSDT"`     |
| `b`    | `bestBidPrice`   | 문자열 (float) | 최우선 매수 가격   | `"25.35190000"` |
| `B`    | `bestBidQty`     | 문자열 (float) | 최우선 매수 수량   | `"31.21000000"` |
| `a`    | `bestAskPrice`   | 문자열 (float) | 최우선 매도 가격   | `"25.36520000"` |
| `A`    | `bestAskQty`     | 문자열 (float) | 최우선 매도 수량   | `"40.66000000"` |

---

#### **2) 주문서 깊이 업데이트 스트림 (Order Book Depth Streams)**

| 필드명 | 전체 이름 (영문) | 데이터 유형      | 설명                              | 예시                  |
| ------ | ---------------- | ---------------- | --------------------------------- | --------------------- |
| `e`    | `eventType`      | 문자열           | 이벤트 유형 (`depthUpdate`)       | `"depthUpdate"`       |
| `E`    | `eventTime`      | 정수 (timestamp) | 이벤트 발생 시간                  | `1672515782136`       |
| `s`    | `symbol`         | 문자열           | 거래 심볼                         | `"BNBBTC"`            |
| `U`    | `firstUpdateId`  | 정수             | 이벤트 시작 시 주문서 업데이트 ID | `157`                 |
| `u`    | `finalUpdateId`  | 정수             | 이벤트 종료 시 주문서 업데이트 ID | `160`                 |
| `b`    | `bids`           | 배열             | 매수 주문서 업데이트 데이터       | `[["0.0024", "10"]]`  |
| `a`    | `asks`           | 배열             | 매도 주문서 업데이트 데이터       | `[["0.0026", "100"]]` |

---

## **4. Redis 저장 구조**

| 데이터 유형        | Redis 키 구조 | 예시 키 |
| ------------------ | ------------- | ------- |
| 거래소 원본 데이터 | `original:<   |

exchange>:<marketSymbol>`|`original:upbit:KRW-BTC`|
| 표준화된 거래소 데이터       |`standardized:<exchange>:<marketSymbol>`|`standardized:binance:BTCUSDT`|
| 전체 마스터 데이터           |`master:<marketSymbol>`         |`master:BTCUSDT`        |
| 거래소별 마스터 데이터       |`master:<exchange>:<marketSymbol>`|`master:upbit:KRW-BTC`  |
| 실시간 호가 업데이트 스트림  |`ticker:<symbol>`               |`ticker:BNBUSDT`        |
| 실시간 주문서 깊이 업데이트  |`depth:<symbol>`                |`depth:BNBBTC` |

---

## **5. 데이터 설계 규칙**

1. **컬럼 이름 요약**

    - 저장 효율성을 위해 필드명을 1~2자로 축약.

2. **공통 심볼 형식**

    - 모든 거래소에서 `s`(symbol)는 표준 형식(`BASEQUOTE`)으로 변환.

3. **시간 통일**

    - `E`(eventTime)는 Unix Timestamp로 저장.

4. **JSON 표준화**
    - 모든 데이터를 JSON 형태로 저장하여 실시간 처리에 적합하도록 설계.

---

## **6. 활용 방안**

1. **거래소 데이터 분석**

    - 전체 및 거래소별 마스터 데이터를 활용하여 시장 활성화 상태를 평가.

2. **실시간 데이터 처리**

    - Redis를 기반으로 실시간 데이터를 조회하고, 알림 및 분석 시스템에 활용.

3. **주문서 유동성 평가**
    - 주문서 깊이 데이터를 분석하여 시장 유동성을 정량화.

---

## **7. 결론**

본 문서는 거래소 데이터의 수집, 표준화, 저장 및 실시간 처리를 위한 설계 지침을 제공합니다.  
Redis를 활용한 데이터 저장 구조와 JSON 기반 설계는 효율성과 확장성을 고려한 최적의 솔루션을 제시합니다.
