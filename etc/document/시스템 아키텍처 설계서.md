# **시스템 아키텍처 설계서**

## **목차**

1. [시스템 개요](#1-시스템-개요)
2. [시스템 핵심 모듈](#2-시스템-핵심-모듈)
3. [구성 요소 간 관계](#3-구성-요소-간-관계)
4. [상태 정의](#4-상태-정의)
5. [메트릭스 정의](#5-메트릭스-정의)
6. [데이터 관리](#6-데이터-관리)
7. [장애 처리](#7-장애-처리)
8. [성능 최적화](#8-성능-최적화)

## **1. 시스템 개요**

### **목적**

-   거래소별 실시간 데이터의 안정적 수집
-   데이터 수집 프로세스의 중앙 집중식 관리
-   시스템 상태의 통합적 모니터링

### **주요 특징**

-   모듈화된 구조로 확장성 확보
-   실시간 데이터 수집과 장애 복구
-   체계적인 상태 관리와 메트릭스 수집

## **2. 시스템 핵심 모듈**

### **2.1 관리기 (Manager)**

#### **역할**

1. 거래소별 데이터 수집기 생성 및 관리
2. 데이터 수집기 상태 중앙 모니터링
3. 시스템 상태 통합 관리 및 성능 최적화

#### **주요 동작**

1. **수집기 생성**

    - 거래소별 현물/선물 단위 데이터 수집기 생성
    - 초기 설정 정보 기반 수집기 초기화

2. **상태 모니터링**

    - 데이터 수집기 활성 상태 점검
    - 작업 성능 및 데이터 수집 상태 추적

3. **장애 복구 관리**

    - 수집기 장애 발생 시 복구 지시
    - 복구 실패 시 관리자 알림

4. **상태 보고**
    - 전체 시스템 상태 통합 관리
    - 성능 지표 수집 및 분석

### **2.2 데이터 수집기 (Exchange Collector)**

#### **역할**

1. 거래소 단위 데이터 수집
2. 수집 대상 코인 그룹화
3. 거래소 연결기 생성 및 관리

#### **주요 동작**

1. **코인 그룹화**

    - 효율적인 데이터 수집을 위한 동적 그룹화
    - 거래소 특성 반영한 그룹 크기 최적화

2. **커넥터 관리**

    - 코인 그룹별 거래소 연결기 생성
    - 커넥터 상태 모니터링

3. **데이터 검증**
    - 수집된 데이터 정합성 검증
    - 누락 데이터 보완 처리

### **2.3 거래소 연결기 (Exchange Connector)**

#### **역할**

1. WebSocket 및 REST API 데이터 수집
2. 코인 그룹 상태 관리
3. 실시간 데이터 처리

#### **주요 동작**

1. **연결 관리**

    - WebSocket 연결 및 구독 관리
    - REST API 호출 최적화

2. **데이터 수집**

    - 실시간 시세 데이터 수신
    - 보완적 REST API 데이터 수집

3. **상태 관리**
    - 코인별 수집 상태 추적
    - 장애 감지 및 복구 처리

## **3. 구성 요소 간 관계**

### **3.1 모듈 간 상호작용**

1. **관리기 ↔ 데이터 수집기**

    - 수집기 생성 및 설정 전달
    - 상태 정보 교환
    - 장애 복구 명령 전달

2. **데이터 수집기 ↔ 거래소 연결기**
    - 코인 그룹 정보 전달
    - 수집 데이터 전송
    - 상태 정보 교환

### **3.2 데이터 흐름**

1. **수집 단계**

    - 거래소 → 거래소 연결기
    - 실시간 데이터 스트림 처리

2. **처리 단계**

    - 거래소 연결기 → 데이터 수집기
    - 데이터 검증 및 정규화

3. **저장 단계**
    - 데이터 수집기 → 저장소
    - 영속성 보장 및 이력 관리

## **4. 상태 정의**

### **4.1 대상 데이터 단위 (Coin)**

| **상태**   | **설명**            |
| ---------- | ------------------- |
| Ready      | 구독 요청 대기 상태 |
| Requested  | 구독 요청 전송 완료 |
| Subscribed | 데이터 정상 수신 중 |
| Stopped    | 데이터 수집 중단    |

### **4.2 거래소 연결기 (Exchange Connector)**

| **상태**                | **설명**       |
| ----------------------- | -------------- |
| Ready                   | 연결 준비 완료 |
| Connecting              | 연결 시도 중   |
| Connected               | 연결 성공      |
| Subscription Requesting | 구독 요청 중   |
| Failed                  | 연결/수신 실패 |
| Recovering              | 복구 진행 중   |

### **4.3 데이터 수집기 (Exchange Collector)**

| **상태** | **설명**       |
| -------- | -------------- |
| Ready    | 수집 준비 완료 |
| Running  | 데이터 수집 중 |
| Stopped  | 수집 중단      |

### **4.4 관리기 (System Manager)**

| **상태** | **설명**       |
| -------- | -------------- |
| Managing | 시스템 관리 중 |

## **5. 메트릭스 정의**

### **5.1 대상 데이터 단위 메트릭스**

| **메트릭**       | **설명**              |
| ---------------- | --------------------- |
| 구독 상태        | 현재 상태 코드        |
| 마지막 수신 시간 | 최근 데이터 수신 시점 |
| 구독 요청 횟수   | 총 구독 요청 수       |
| 구독 실패 횟수   | 실패한 구독 요청 수   |
| 평균 수신 간격   | 데이터 수신 간격 평균 |

### **5.2 거래소 연결기 메트릭스**

| **메트릭**     | **설명**                 |
| -------------- | ------------------------ |
| 연결 상태      | 현재 연결 상태           |
| 연결 성공률    | WebSocket 연결 성공 비율 |
| 구독 성공률    | 구독 요청 성공 비율      |
| 복구 성공률    | 장애 복구 성공 비율      |
| 활성 데이터 수 | 활성 코인 수             |

### **5.3 데이터 수집기 메트릭스**

| **메트릭**         | **설명**            |
| ------------------ | ------------------- |
| 수집기 상태        | 현재 작동 상태      |
| 처리 속도          | 초당 처리 레코드 수 |
| 에러 발생 수       | 총 에러 발생 횟수   |
| 시스템 자원 사용률 | CPU, 메모리 사용량  |

## **6. 데이터 관리**

### **6.1 데이터 구조**

1. **수집 대상 정보**

    - 거래소 식별자
    - 코인 심볼
    - 시장 유형 (현물/선물)

2. **시세 데이터**
    - 타임스탬프
    - 가격 정보
    - 거래량 정보

### **6.2 데이터 저장**

1. **실시간 데이터**

    - 메모리 캐시 활용
    - 최신 상태 유지

2. **히스토리 데이터**
    - 시계열 데이터베이스 저장
    - 효율적인 검색 구조

## **7. 장애 처리**

### **7.1 장애 유형**

1. **연결 장애**

    - WebSocket 연결 끊김
    - API 응답 지연/실패

2. **데이터 장애**
    - 데이터 누락
    - 데이터 정합성 오류

### **7.2 복구 전략**

1. **자동 복구**

    - 재연결 시도
    - 데이터 재수집

2. **수동 개입**
    - 임계치 초과 시 알림
    - 관리자 조치 요청

## **8. 성능 최적화**

### **8.1 최적화 전략**

1. **리소스 관리**

    - 메모리 사용량 최적화
    - CPU 부하 분산

2. **처리량 최적화**
    - 배치 처리 활용
    - 버퍼링 전략 적용

### **8.2 성능 모니터링**

1. **시스템 메트릭스**

    - 자원 사용률 추적
    - 처리 지연 모니터링

2. **튜닝 포인트**
    - 그룹 크기 조정
    - 버퍼 크기 최적화
